jQuery((function($){WCML_Currency_Switcher_Settings={_currency_languages_saving:0,init:function(){$((function(){$(document).on("change","#currency_switcher_style",WCML_Currency_Switcher_Settings.update_currency_switcher_style),$(document).on("click",".currency_switcher_save",WCML_Currency_Switcher_Settings.save_currency_switcher_settings),$(document).on("click",".delete_currency_switcher",WCML_Currency_Switcher_Settings.delete_currency_switcher),$(document).on("change",".js-wcml-cs-colorpicker-preset",WCML_Currency_Switcher_Settings.set_currency_switcher_color_pre_set),$(document).on("keyup",'input[name="wcml_curr_template"]',WCML_Currency_Switcher_Settings.setup_currency_switcher_template_keyup),$(document).on("change",'input[name="wcml_curr_template"]',WCML_Currency_Switcher_Settings.setup_currency_switcher_template_change),$(document).on("click",".js-wcml-learn-more-button",WCML_Currency_Switcher_Settings.open_learn_more_diaglog),WCML_Currency_Switcher_Settings.open_dialog_from_hash(),document.addEventListener("wcmlActiveCurrenciesChange",(function(e){var action=e.detail.action,currency=e.detail.currency,currencyData=e.detail.currencyData;wcmlMultiCurrency&&wcmlMultiCurrency.activeCurrencies&&wcmlMultiCurrency.activeCurrencies.length<2?$("#wcml_mc_options_submit").click():"add"===action?$("#wcml_currencies_order").append('<li class="wcml_currencies_order_'+currency.code+' ui-sortable-handle" cur="'+currency.code+'">'+currencyData.label+" ("+currencyData.symbol+")</li>"):"remove"===action&&$("#wcml_currencies_order .wcml_currencies_order_"+currency.code).remove()})),document.addEventListener("wcmlCurrencyModeChange",(function(e){$("#display_custom_prices_select,#currency-switcher, #currency-switcher-widget, #currency-switcher-product, #multi-currency-per-language-details, #online-exchange-rates").fadeIn()}))}))},initColorPicker:function(){$(".wcml-ui-dialog .js-wcml-cs-panel-colors").find(".js-wcml-cs-colorpicker").wpColorPicker({change:function(e){var dialog=$(this).closest(".wcml-ui-dialog");WCML_Currency_Switcher_Settings.currency_switcher_preview(dialog)},clear:function(e){var dialog=$(this).closest(".wcml-ui-dialog");WCML_Currency_Switcher_Settings.currency_switcher_preview(dialog)}})},save_currency_switcher_settings:function(){var dialog=$(this).closest(".wcml-ui-dialog"),ajaxLoader=$('<span class="spinner" style="visibility: visible;"></span>'),widget_name=dialog.find("#wcml-cs-widget option:selected").text(),switcher_id=dialog.find("#wcml_currencies_switcher_id").val(),widget_id=dialog.find("#wcml-cs-widget").val(),widget_title=dialog.find('input[name="wcml_cs_widget_title"]').val(),switcher_style=dialog.find("#currency_switcher_style").val();ajaxLoader.show(),$(this).parent().append(ajaxLoader),dialog.find(":submit,:button").prop("disabled",!0);var template=dialog.find('input[name="wcml_curr_template"]').val();template||(template=dialog.find("#currency_switcher_default").val());var color_scheme={};return dialog.find("input.js-wcml-cs-colorpicker").each((function(){color_scheme[$(this).attr("name")]=$(this).val()})),$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:{action:"wcml_currencies_switcher_save_settings",wcml_nonce:dialog.find("#wcml_currencies_switcher_save_settings_nonce").val(),switcher_id:switcher_id,widget_id:widget_id,widget_title:widget_title,switcher_style:switcher_style,template:template,color_scheme:color_scheme},success:function(e){if(dialog.find(".ui-dialog-titlebar-close").trigger("click"),void 0===widget_id&&(widget_id=switcher_id),$("#wcml_currency_switcher_options_form_new_widget #wcml-cs-widget option").each((function(){$(this).val()==widget_id&&$(this).remove()})),0==$("#wcml_currency_switcher_options_form_new_widget #wcml-cs-widget option").length&&$(".wcml_add_cs_sidebar").fadeOut(),$("#currency-switcher-widget .wcml-cs-list").find("thead tr").is(":hidden")&&$("#currency-switcher-widget .wcml-cs-list").find("thead tr").fadeIn(),0==$(".wcml-currency-preview."+widget_id).length){var widget_row=$(".wcml-cs-empty-row").clone();widget_row.removeClass("wcml-cs-empty-row"),widget_row.find(".wcml-currency-preview").addClass(widget_id),widget_row.find(".wcml-cs-widget-name").html(widget_name),widget_row.find(".edit_currency_switcher").attr("data-switcher",widget_id),widget_row.find(".edit_currency_switcher").attr("data-dialog","wcml_currency_switcher_options_"+widget_id),widget_row.find(".edit_currency_switcher").attr("data-content","wcml_currency_switcher_options_"+widget_id),widget_row.find(".delete_currency_switcher").attr("data-switcher",widget_id),widget_row.show(),$(".wcml-cs-list").find("tr.wcml-cs-empty-row").before(widget_row),$(".wcml-cs-list").is(":hidden")&&$(".wcml-cs-list").fadeIn()}$("#wcml_currency_switcher_options_"+widget_id).remove(),dialog.find(".wcml-dialog-container").attr("id","wcml-dialog-wcml_currency_switcher_options_"+widget_id),dialog.find(":submit,:button").prop("disabled",!1),dialog.find("#wcml_currencies_switcher_id").val(widget_id),ajaxLoader.remove(),WCML_Currency_Switcher_Settings.currency_switcher_preview(dialog,!0)}}),!1},delete_currency_switcher:function(e){e.preventDefault();var switcher_id=$(this).data("switcher"),switcher_row=$(this).closest("tr"),ajaxLoader=$('<span class="spinner" style="visibility: visible;">');$(this).parent().html(ajaxLoader),$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:{action:"wcml_delete_currency_switcher",wcml_nonce:$("#wcml_delete_currency_switcher_nonce").val(),switcher_id:switcher_id},success:function(e){var sidebar_name=switcher_row.find(".wcml-cs-widget-name").html();$("#wcml_currency_switcher_options_form_new_widget #wcml-cs-widget").append('<option value="'+switcher_id+'">'+sidebar_name+"</option>"),switcher_row.remove(),1==$("#currency-switcher-widget .wcml-cs-list").find("tbody tr").length&&$("#currency-switcher-widget .wcml-cs-list").find("thead tr").fadeOut(),$(".wcml_add_cs_sidebar").is(":hidden")&&$(".wcml_add_cs_sidebar").fadeIn()}})},currency_switcher_preview:_.debounce((function(dialog,update_settings){var template=dialog.find('input[name="wcml_curr_template"]').val();template||(template=dialog.find("#currency_switcher_default").val());var ajaxLoader=$('<span class="spinner" style="visibility: visible;">');dialog.find("#wcml_curr_sel_preview_wrap").append(ajaxLoader);var color_scheme={};dialog.find("input.js-wcml-cs-colorpicker").each((function(){color_scheme[$(this).attr("name")]=$(this).val()}));var switcher_id=dialog.find("#wcml_currencies_switcher_id").val(),switcher_style=dialog.find("#currency_switcher_style").val();$.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"wcml_currencies_switcher_preview",wcml_nonce:dialog.find("#wcml_currencies_switcher_preview_nonce").val(),switcher_id:switcher_id,switcher_style:switcher_style,template:template,color_scheme:color_scheme},success:function(resp){resp.success&&(resp=resp.data,0==$("#"+resp.inline_styles_id).length?$("head").append('<style type="text/css" id="'+resp.inline_styles_id+'">'+resp.inline_css+"</style>"):$("#"+resp.inline_styles_id).html(resp.inline_css),ajaxLoader.remove(),update_settings?("new_widget"==switcher_id&&(switcher_id=dialog.find("#wcml-cs-widget").val()),$(".wcml-currency-preview."+switcher_id).html(resp.preview)):dialog.find(".wcml-currency-preview").html(resp.preview),"wcml-dropdown-click"==switcher_style&&WCMLCurrecnySwitcherDropdownClick.init())}})}),500),set_currency_switcher_color_pre_set:function(){var color_sheme=$(this).val(),dialog=$(this).closest(".wcml-ui-dialog");if("undefined"!=settings.pre_selected_colors[color_sheme]){var color,selected_scheme=settings.pre_selected_colors[color_sheme];for(color in selected_scheme)$('.wcml-ui-dialog input[name="'+color+'"]').val(selected_scheme[color]),$('.wcml-ui-dialog input[name="'+color+'"]').closest(".wp-picker-container").find(".wp-color-result").css("background-color",selected_scheme[color])}WCML_Currency_Switcher_Settings.currency_switcher_preview(dialog)},update_currency_switcher_style:function(e){var dialog=$(this).closest(".wcml-ui-dialog");WCML_Currency_Switcher_Settings.currency_switcher_preview(dialog)},setup_currency_switcher_template_keyup:function(e){var dialog=$(this).closest(".wcml-ui-dialog");discard=!0,$(this).closest(".wcml-section").find(".button-wrap input").css("border-color","#1e8cbe"),WCML_Currency_Switcher_Settings.currency_switcher_preview(dialog)},setup_currency_switcher_template_change:function(e){$(this).val()||$(this).val($("#currency_switcher_default").val())},open_learn_more_diaglog:function(event){event.preventDefault();const arrow=$(this).closest(".wcml-ui-dialog").find(".js-arrow-toggle"),description=$(".js-wcml-learn-more-content"),learnLabel=$(this).closest(".wcml-ui-dialog").find(".js-wcml-learn-more-text"),hideLabel=$(this).closest(".wcml-ui-dialog").find(".js-wcml-hide-more-text");description.toggle();const isVisible=description.is(":visible");learnLabel.toggle(!isVisible),hideLabel.toggle(isVisible),arrow.toggleClass("otgs-ico-caret-down",!isVisible).toggleClass("otgs-ico-caret-up",isVisible)},open_dialog_from_hash:function(){var hashParts=window.location.hash.substring(1).split("/"),type=hashParts[0]||"",slug=hashParts[1]||"";"currency-switcher"==type&&($('.edit_currency_switcher[data-switcher="'+slug+'"]').trigger("click"),parent.location.hash="")}},WCML_Currency_Switcher_Settings.init()}));